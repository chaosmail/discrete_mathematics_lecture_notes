\section{Euler-Fermat Theorem and RSA-Algorithm}

\Theorem.
$(\mathbb{Z}_m^{*}, \cdot)$ is a group.
\begin{align*}
  &|\mathbb{Z}_m| = m, \\
  &|\mathbb{Z}_m^{*}| = \varphi(m) \\
  &\varphi \ldots \text{ Euler's totient function}
\end{align*}

E.g.: $\varphi(5) = 4, \varphi(6) = 2$

Consider two cases. First case:
\[
  m \in \mathbb{P}: \varphi(m) = m-1 \\
\]
Second case:
\begin{align*}
  &m = p^e, p \in \mathbb{P}, e \geq 1 \\
  &\bar{a}\in \mathbb{Z}_m \implies \gcd(a,p^e) = \begin{cases}
    1   &\text{ if $\bar{a} \in \mathbb{Z}_m^{*}$} \\
    p^f &\text{ $1 \leq f < e$}
  \end{cases} \\
  &\bar{a}\in \mathbb{Z}_m^{*} \Leftrightarrow p \not|a \\
  & \underbrace{0,1,2, \ldots, p^e -1}_{p^e}\\
\end{align*}\vspace{-1.5cm}
\begin{align*}
  p^e - p^{e-1} = \varphi(\underbrace{p^e}_{m}) &= p^{e-1}(p-1) \\
                \varphi(m) &= m\left(1-\frac{1}{p}\right)
\end{align*}

\Theorem.
\begin{align*}
  m &= p_1^{e_1} p_2^{e_2} \ldots p_r^{e_r} \\
  \implies \varphi(m) &= m \left( 1-\frac{1}{p_1} \right) \left( 1-\frac{1}{p_2} \right) \ldots \left( 1-\frac{1}{p_r} \right)
\end{align*}

\Proof.
Let $r=2: M = \{1,2, \ldots, m\},$
\begin{align*}
  A = \{ n \in M \mid p_1|n\} = \{p_1, 2p_1, 3p_1, \ldots m-p_1, m\} \\
  B = \{ n \in M \mid p_2|n\} = \{p_2, 2p_2, 3p_2, \ldots m-p_2, m\} \\
\end{align*}

\begin{align*}
  |M| &= m, \; |A| = \frac{m}{p_1}, \; |B| = \frac{m}{p_2}, \;
    |A \cap B| = \frac{m}{p_1p_2}\\
  \varphi(m)
    &= | M \backslash(A\cup B) | \\
    &= |M| - |A| - |B| + | A \cap B|\\
    &= m \left(1- \frac{1}{p_1} \right) \left(1- \frac{1}{p_2} \right)
\end{align*}

\Theorem.
Theorem of Euler-Fermat:
\[
  \gcd(a,m) = 1 \implies a ^{\varphi(m)} \equiv 1 (m)
\]
In particular:
\[
  p \in \mathbb{P}, p \not| a \implies a^{p-1} \equiv 1 (p) \quad
  \text{(Fermat's Little Theorem)}
\]

\Proof.
\[
  \mathbb{Z}_m^{*} = \{\bar{a}_1, \bar{a}_2, \ldots, \bar{a}_k \}, \;k = \varphi(m)
\]
\begin{align*}
  &\implies \mathbb{Z}_m^{*} \{\bar{a}\bar{a}_1, \bar{a}\bar{a}_2, \ldots, \bar{a}\bar{a}_k \}, \\
  &\text{ since } \bar{a}\bar{a}_i = \bar{a}\bar{a}_j
    \implies \bar{a}_i = \bar{a}_j \implies i = j \\
  &\implies \underbrace{\bar{a}_1, \bar{a}_2, \ldots, \bar{a}_k}_
        {\in \mathbb{Z}_m^{*}}
      = \bar{a}^k \cdot \underbrace{\bar{a}_1, \bar{a}_2, \ldots, \bar{a}_k}_
        {\in \mathbb{Z}_m^{*}} \\
  &\implies \bar{a}^k = \bar{a}^{\varphi(m)} = \bar{1}
\end{align*}

\Theorem.
\[
  p, q \in \mathbb{P} \quad p,q \text{ odd} \quad p \neq q
\]
\begin{align*}
  m = pq, \quad v = \lcm(p-1, q-1) \\
  \implies \forall a,k \in \mathbb{Z}: a^{kv + 1} \equiv a(m)
\end{align*}

\Proof.
We have to show: $pq \mid a ^{kv +1} - a$.
\begin{align*}
  &\Leftrightarrow p \mid a ^{kv +1} - a \text{ and } q \mid a ^{kv +1} - a\\
  &\text{Case 1: } p \mid a \\
  &\text{Case 2: } p \not|~ a:
    a^{p-1} \equiv 1 (p) \implies a^{kv} \equiv 1(p) \implies a^{kv+1} \equiv a(p)
\end{align*}

\subsection{RSA-Algorithm}
Let $m = pq$ and $v = \lcm(p-1, q-1)$ then
\[
  \gcd(e,v) = 1 \implies \exists d : d \cdot e \equiv 1 (v).
\]

We have a message $a_1, a_2, a_3, \ldots$ where $0 \leq a_i < m$

Encryption:
\[
  E(a_j) = b_j := a_j^e \imod{m}
\]

Decryption:
\[
  D(b_j) = a_j := b_j^d \imod{m}
\]

Check if this really works:
\begin{align*}
  b_j^d &\equiv (a_j^e)^d \imod{m} \\
    & \equiv a_j^{e \cdot d} \imod{m} \\
    & \equiv a_j^{kv+1} \pod{m} \\
    & \equiv a_j \pod{m} \\
\end{align*}

We can provide a public key $(m,e)$ and the private key $d$.

If we want to compute the private key and we only know the public key, then the hard part is the factorisation $m = p \cdot q$. The time needed for this factorisation grows exponentially with the number of digits of $m$.

\textbf{e-Signature: }
$(e_j,d_j)$,

$e_j$ is public $\hat{=} E_j, D_j$

User i sends to user j:
\[
  E_j(D_i(x)) = x^{d_i e_j} (m)
\]
User j checks with his private key:
\[
  D_j (E_J(D_i(x))) = D_i(x)
\]
then $E_i$ afterwards:
\[
  E_i(D_i(x)) = x
\]

\textbf{Caveat. (Warning)}
$E(x)$ may have many fixed points.
If the order is low then it is possible to find $x$.

\textbf{Recall.}
If $G$ is a group and $x\in G$:
\[
  \ord_G(x) = \min\{ i\in \mathbb{N}^{+} \mid x^i = e \}
\]
\[
  e^1 = e \implies \ord_G(e) = 1, a \neq e \implies \ord_G(a) > 1 \quad \text{e = neutral element}
\]

\textbf{Cyclic group.}
The group generated by $x$:
\[
  \{ e, x, x^2, x^3, \ldots \} = \GroupGenBy{x}
\]

G is finite:
\begin{align*}
  U & \underbrace{\leq}_{\text{subgroup}}  G \implies |U| \mid |G|\\
  |G| & â€¦\text{Order of the group}\\
      \GroupGenBy{x} &= \{ e, x, x^2, x^3, \ldots x^{\ord_G(x) -1}\} \\
    & \implies |\GroupGenBy{x}| = \ord_G(x)\\
\end{align*}

\begin{align*}
  \text{G is cyclic} & \Leftrightarrow \exists x \in G: \GroupGenBy{x} = G \\
                     & \Leftrightarrow \exists x \in G: \ord_G(x) = |G|
\end{align*}

Trivial group: $\GroupGenBy{e} = \{e\}$\\
A group is always a subgroup of itself: $G \leq G$

\begin{definition}
  \[
    \bar{a} \in \mathbb{Z}_m^{*} \text{ s.t. } \GroupGenBy{\bar{a}} = \mathbb{Z}_m^{*}
\]
is called \dt{primitive root mod m}

$\bar{a}$ primitive root mod m
$\implies \mathbb{Z}_m^{*} = \{\bar{a}, \bar{a}^2, \bar{a}^3, \ldots, \bar{a}^{\varphi(m)} =\bar{1} \}$
\end{definition}

\textbf{Example.}
\begin{align*}
  &\mathbb{Z}_2^{*} = \{\bar{1}\} = \GroupGenBy{\bar{1}} \\
  &\mathbb{Z}_3^{*} = \{\bar{1}, \bar{2}\} = \GroupGenBy{\bar{2}}
    = \{\bar{2}, \bar{2}^2 \} = \{\bar{2}, \bar{1}\}\\
  &\mathbb{Z}_4^{*} = \{\bar{1}, \bar{3}\} = \GroupGenBy{\bar{3}} \\
  &\mathbb{Z}_5^{*} = \{\bar{1}, \bar{2}, \bar{3}, \bar{4}\}
    = \GroupGenBy{\bar{2}} = \GroupGenBy{\bar{3}} \neq \GroupGenBy{\bar{4}}
    = \{\bar{1}, \bar{4}\} \\
  &\mathbb{Z}_8^{*} = \{\bar{1}, \bar{3}, \bar{5}, \bar{7}\} \text{ has no primitive roots} \implies \mathbb{Z}_8^{*}\text{ is not a cyclic group} \\
  & \quad \GroupGenBy{\bar{1}} = \{\bar{1}\} \quad \GroupGenBy{\bar{3}}=\{\bar{3}, \bar{3}^2\}=\{\bar{3}, \bar{1}\} \\
  & \quad \GroupGenBy{\bar{5}}=\{\bar{5}, \bar{5}^2\}=\{\bar{5}, \bar{1}\} \\
  & \quad \GroupGenBy{\bar{7}}=\{\bar{7}, \bar{7}^2\}=\{\bar{7}, \bar{1}\}
\end{align*}

\Theorem.
$\mathbb{Z}_m^{*}$ cyclic
\begin{align*}
  & \Leftrightarrow \exists \text{ primitive root mod m} \\
  & \Leftrightarrow m \in \{2,4\} \cup \{ p^e \mid p \in \mathbb{P} \backslash \{2\}, e \geq 1 \} \cup \{ 2p^e \mid p \in \mathbb{P} \backslash \{2\}, e \geq 1 \}
\end{align*}

\Proof.
Let $g$ be a primitive root mod $p \Rightarrow g^{p-1} \equiv 1 (p), \forall i < p-1 : g^i \not\equiv 1 (p) $

Then $g$ or $g+p$ is a primitive root mod $p^2$.

\textbf{Claim.}
$g^{p-1} \not\equiv 1 (p^2)$ or $(g+p)^{p-1} \not\equiv 1 (p^2)$

\textbf{Note.}
$\varphi(p^2) = p(p-1)$, assume that $p-1 = k \cdot l$ where $(k, l < p-1)$

$\ord_{\mathbb{Z}^{*}_{p^2}}(g) = p \cdot l \implies g^{pl} \equiv 1 (p^2)$

\textbf{Remember from last time}
\lecturedate[\baselineskip]{2013-12-12}

\Theorem. $\mathbb{Z}_m^{*}$ is cyclic $\Leftrightarrow$ \dots

\Lemma. $g$ is primitive root $\bmod p \implies g$ or $g+p$ is a primitive root $\bmod{p^2}$.

\begin{leftbar}
  $\mathbb{Z}_p^{*} = \{\bar{1}, \bar{2}, \ldots \overline{p-1}\}$
\end{leftbar}
\Proof.
\begin{align*}
  &\GroupGenBy{g} = \mathbb{Z}_p^{*} \Leftrightarrow g^{p-1} \equiv 1 (p) \land \forall 1 < r < p-1 : g^r \not\equiv 1(p) \\
  &s : = ord_{\mathbb{Z}_{p^2}^{*}} (g) \Rightarrow g^s \equiv 1 (p^2) \Rightarrow g^s \equiv 1 (p) \Rightarrow s \geq p-1
\end{align*}

\textbf{Claim.}
\[
  g^{p-1} \not\equiv 1 (p^2) \text{ or } (g+p)^{p-1} \not\equiv 1(p^2)
\]

\textbf{Proof of Claim.}
\begin{alignat*}{2}
  &\text{If } g^{p-1} \equiv 1(p^2)
  &&\Rightarrow (g+p)^{p-1} \equiv \underbrace{\underbrace{g^{p-1}}_{\equiv 1} + \underbrace{pg^{p-2}}_{\gcd(g,p) = 1 \Rightarrow pg^{p-2}\not\equiv 0 (p^2)}}_{\not\equiv 1} (p^2)\\
  &\text{If } (g+p)^{p-1} \equiv 1(p^2)
  &&\Rightarrow \underbrace{g^{p-1}}_{\not\equiv 1\Leftarrow} + \underbrace{pg^{p-2}}_{\not\equiv 0} \equiv 1 (p^2)
\end{alignat*}

\textbf{Case 1.} $g^{p-1} \not\equiv 1 (p^2)$
\begin{align*}
  &s \geq p, \quad\text{Note: } \varphi(p^2) = p(p-1) \Rightarrow s \mid p(p-1) \\
  &\Rightarrow s = p-l \text{ where } p-1 = k\cdot l \quad (k,l < p-1) \\
  &g^{pl} \equiv 1 (p^2) \\
  &g^{pl} = (g^p)^l \equiv g^l \equiv 1 (p) \\
  &\text{Contradiction except for } l = p-1 \text{ !}\\
  &\implies s = p(p-1) \implies g \text{ primitive root } \bmod p^2
\end{align*}

\textbf{Case 2.} $(g+p)^{p-1} \not\equiv 1 (p^2)$ similar\\

\Lemma.
$g$ primitive $\text{root}\bmod{p} ~ (p \neq 2)$ $\implies$ either $g$ or $g+p$ is a primitive $\text{root}\bmod{p^e} ~ (e \geq 2)$

\Lemma.
If $h$ is a primitive $\text{root} \bmod{p^e} \implies$ $h$ or $h+p^e$ is a primitive root $\text{root} \bmod{2p^e}$

\begin{definition}
  \dt{Carmichael function}
  $\lambda(m) = max_{\bar{a} \in \mathbb{Z}_m^{*}} ~ord_{\mathbb{Z}_m^{*}}\pod{\bar{a}}$
\end{definition}

\Remark.
\begin{enumerate}[a)]

  \item $\lambda(m) \mid \varphi(m)$

  \item $p \in P \backslash\{2\} \implies \lambda(p^e) = \varphi(p^e) = p^{e-1}(p-1)$ \\
  $\lambda(1) := \varphi(1) = 1$\\
  $\lambda(2) = \varphi(2) = 1$\\
  $\lambda(4) = \varphi(4) = 2$

  \item $\lambda(2^e) = 2^{e-2} \text{ for } e \geq 3$ \\
  $\lambda(2^e) = ord_{\mathbb{Z}_{2^e}^{*}}(5)$

\end{enumerate}

\subsection{The Order of Elements of an Abelian Group $G$ With Neutral Element $e$}
\Theorem.
\[
  \ord(a) = r, \ord(b) = s, \gcd(r,s) = 1 \implies \ord(ab) = rs
\]

\Proof.
\begin{align*}
  &(ab)^{rs} = (\underbrace{a^r}_{e})^s (\underbrace{b^s}_{e})^r = e \implies \underbrace{\ord(ab)}_{n} \mid rs \\
  &e = (ab)^n = a^n b^n \implies a^n = (b^{-1})^n \implies e = a^{rn} = (b^{-1})^{nr} \quad (*)\\
  &(b^{-1})^k = e \Leftrightarrow b^k = e \stackrel{(*)}{\implies} b^{nr} = e \implies s \mid nr \implies s \mid n \\
\end{align*}
Analogously:
\[
  r \mid n \implies n = rs
\]

\textbf{Corollary.}
\begin{align*}
  \ord(a^k) = \ord(a) \Leftrightarrow \gcd(k, ord(a)) = 1
\end{align*}

\Theorem.
If $ab \in G: \ord(a)=r, \ord(b) = s$ then $\exists c \in G: \ord(c) = \lcm(r,s)$

\Proof.
\begin{align*}
  &r = \prod_{i\in I} p_i^{e_i}, s = \prod_{i\in I} p_i^{f_i}, \quad  e_i, f_i \geq 0\\
  &\lcm(r,s) = \prod_{i\in I} p_i^{\max(e_i,f_i)}\\
  &\gcd(r,s) = \prod_{i\in I} p_i^{\min(e_i,f_i)}
\end{align*}
\begin{align*}
  \implies \lcm(r,s) \cdot \gcd(r,s) = r \cdot s\\
  I_1 = \{i \in I \mid e_i \leq f_i\}, I_2 = I \backslash I_1
  \implies
     & r = \prod_{i\in I_1} p_i^{e_i} \prod_{i\in I_2} p_i^{e_i} \\
     & s = \prod_{i\in I_1} p_i^{f_i} \prod_{i\in I_2} p_i^{f_i} \\
\end{align*}
\begin{align*}
  &d_1 = \prod_{i\in I_1} p_i^{e_i}, d_2 = \prod_{i\in I_2} p_i^{f_i}, \quad \gcd(r,s) = d_1 d_2 \\
  &\implies \ord\left(a^{d_1}\right) = \frac{r}{\gcd(r,d_1)} = \frac{r}{d_1} \text{ and } \ord\left(b^{d_2}\right) = \frac{s}{d_2}
\end{align*}

Observe.
\begin{align*}
  \gcd\left(\frac{r}{d_1}, \frac{s}{d_2} \right) = 1
    \implies \ord(a^{d_1} b^{d_2}) =
    \frac{rs}{d_1 d_2} = \lcm(r,s)
\end{align*}

\textbf{Corollary.}
\[
  \text{If } a_1, \ldots, a_r \text{ with } \ord(a_i) = k_i
  \implies \exists a \in G: \ord(a) = \lcm(k_1, k_2, \ldots, k_r)
\]

\subsection{And now to Something Completely Different!}

\[
  \lambda(n), n = \prod_{i = 1}^{r} p_i^{e_i}, e_i > 0
\]
\begin{alignat*}{2}
\text{Let } &a_i \in \mathbb{Z}_{p_i^{e_i}}^{*} &&\text{ such that } \ord(a_i) = \varphi(p_i^{e_i}) = \lambda(p_i^{e_i})\\
  &b_i \in \mathbb{Z}_n &&\text{ such that } b_i \equiv 1 (p_j^{e_j}) \quad \forall j \neq i \text{ and } b_i \equiv a_i (p_i^{e_i})
\end{alignat*}
$b_i$ exists by Chinese remainder theorem

\textbf{Claim.}
\[
  \ord_{\mathbb{Z}_n^{*}}(b_i) = \ord_{\mathbb{Z}_{p_i^{e_i}}^{*}} (b_i) = \lambda(p_i^{e_i})
\]

\Proof.
For $b_i^k \equiv 1 (n)$ we must have $b_i^k \equiv 1 (p_j^{e_j}) \quad \forall j = 1, \ldots, r$
\begin{align*}
  &b_i = c\cdot n+1 = c c_1 p_j^{e_j} +1 \implies b_i^k \equiv a_i^k \equiv 1 (p_i ^{e_i}) \\
  &k_{\min} = \lambda(p_i^{e_i}) \implies \ord_{\mathbb{Z}_n^{*}}(b_i) \geq \lambda(p_i^{e_i}) \\
  &b_i^{k_{\min}} \equiv 1 (p_j^{e_j}) \quad \forall j \implies b_i^{k_{\min}} \equiv 1 (n)
\end{align*}

We found $b_1, b_2, \ldots, b_r \in \mathbb{Z}_n$ such that $\ord_{\mathbb{Z}_n^{*}}(b_i) = \lambda(p_i^{e_i}) \quad \forall i = 1, \ldots, r$
\begin{align*}
  &\implies \exists b \in \mathbb{Z}_n^{*} \text{ such that } \ord_{\mathbb{Z}_n^{*}}(b) = \lcm(\lambda(p_1^{e_1}), \lambda(p_2^{e_2}), \ldots, \lambda(p_r^{e_r})) =: K \\
  &\implies \lambda(n) \geq K \text{ We want to show $\lambda(n) = K$}
\end{align*}

\Theorem.
If $ a\in G, \ord_G(a)$ maximal, then $\forall b \in G: \ord_G(b) \mid \ord_G(a)$

\Proof.
Exercise for the students

Let
\[
  a\in \mathbb{Z}_n: a^k \equiv 1 (n) \Leftrightarrow a^k \equiv 1 (p_i^{e_i}) \quad \forall i = 1,\ldots, r
\]
\begin{align*}
  &\lambda(p_i^{e_i}) = \text{ max order in } \mathbb{Z}_{p_i^{e_i}}^{*} \implies \ord_{\mathbb{Z}_{p_i^{e_i}}^{*}}(a) \mid \underbrace{\lambda(p_i^{e_i})}_{\lambda(p_i^{e_i}) \mid K}\\
  &\Rightarrow \ord_{\mathbb{Z}_{p_i^{e_i}}^{*}}(a) \mid K \implies a^K \equiv 1 (p_i^{e_i}) \quad \forall i \\
  &\Leftrightarrow a^K \equiv 1 (n) \implies \ord_{\mathbb{Z}_{n}^{*}}(a) \mid K \implies  \ord_{\mathbb{Z}_n^{*}}(a) \leq K \implies \lambda(n) = K
\end{align*}

\Theorem.
The Carmichael function $\lambda(n)$ obeys the following rules

\begin{itemize}
  \item $\lambda(1) = 1, \lambda(2) = 1, \lambda(4) = 2, \lambda(2^e) = 2^{e-2} $ for $e \geq 3$
  \item $\lambda(p^e) = p^{e-1}(p-1)$ for $p\in \mathbb{P} \backslash\{2\}$
  \item $\displaystyle{\lambda\left(\prod_{i=1}^{r} p_i^{e_i}\right) = \lcm(\lambda(p_1^{e_1}), \ldots, \lambda(p_r^{e_r}))}$
\end{itemize}

\textbf{Example.}
\[
  \lambda(100) = \lambda(2^2 \cdot 5^2) = \lcm(\lambda(4), \lambda(25)) = \lcm(2,20) = 20
\]

\textbf{Ad. RSA.}
Attack by message iteration:
\begin{align*}
  n = pq               & \quad (n,e) \text{ public key}\\
                       & \quad (n,d) \text{ private key}\\
  x \text{ message}    & \quad y_0 = x, y_1 = x^e (n), y_i = y_{i-1}^{e} (n)\\
  \text{Search for k:} & \quad y_k = x\\
                       & \quad y_i = x^{(e^i)} (n)\\
                       & \quad ed \equiv 1 (v)\\
                       & \quad v = \lcm(p-1, q-1) = \lambda(n)\\
                       & \quad x ^{v+1} \equiv x (n)
\end{align*}

The minimal $k$ such that $ y_k = x$ is $k_0 = \ord_{\mathbb{Z}_v^{*}}(e) = \ord_{\mathbb{Z}_{\lambda(n)}^{*}}(e)$ \\
$k_0 \mid \lambda(\lambda(n))$

Look for $p,q$ such that $\lambda(\lambda(n))$ is large.

If $p,q$ are such that $\frac{p-1}{2}, \frac{p-3}{4}, \frac{q-1}{2}, \frac{q-3}{4}$ are primes too,
then
\begin{align*}
 \lambda(pq) &= \lcm(p-1, q-1) = 2 \cdot \frac{p-1}{2} \frac{q-1}{2} = \frac{(p-1)(q-1)}{2} \\
  \lambda(\lambda(pq)) &= \lcm(\underbrace{\lambda(2)}_{1}, \underbrace{\lambda( \frac{p-1}{2} )}_{\frac{p-3}{2}}, \underbrace{\lambda( \frac{q-1}{2} )}_{\frac{q-3}{2}}) = \frac{(p-3)(q-3)}{8} \quad \sim \quad \frac{n}{8}
\end{align*}
